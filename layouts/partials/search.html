<!-- Generated by pagefind along with search index when running pagefind during build -->
<link rel="stylesheet" href="/pagefind/pagefind-ui.css">
<!-- Generated by pagefind along with search index when running pagefind during build -->
<script type="text/javascript" src="/pagefind/pagefind-ui.js"></script>

<link rel="stylesheet" href="./theme-css/search.css">

<!-- Wasn't able to get this to resolve (404).
<script type="text/javascript" src="./js/search.js"></script>

  Also tried putting it into a dedicated theme-js directory next to theme-css, but no luck.
  Any suggestions?
-->

<dialog class="search-dialog"></dialog>

<script type="text/javascript">
  window.addEventListener('DOMContentLoaded', () => {
    new PagefindUI({
      element: '.search-dialog',
      autofocus: true,
      resetStyles: false,
      showSubResults: true,
    });

    let searchDialog = document.querySelector('.search-dialog');

    let showSearch = () => searchDialog.showModal();
    let hideSearch = () => searchDialog.close();

    let toggleSearch = () => {
      if (!searchDialog.open) {
        showSearch();
      } else {
        hideSearch();
      }
    };

    let isClickOutside = (elem, clickEvt) => {
      const elemDims = elem.getBoundingClientRect();
      return (
        clickEvt.clientX < elemDims.left ||
        clickEvt.clientX > elemDims.right ||
        clickEvt.clientY < elemDims.top ||
        clickEvt.clientY > elemDims.bottom
      );
    };

    // Close the search dialog if user clicks outside of it when it is open.
    // This feels like functionality that should really be natively supported
    // by the dialog element already.
    // https://blog.webdevsimplified.com/2023-04/html-dialog/
    searchDialog.addEventListener('click', (evt) => {
      if (searchDialog.open && isClickOutside(searchDialog, evt)) {
        hideSearch();
      }
    });

    window.addEventListener('keydown', (evt) => {
      if (evt.key === 'k' && evt.ctrlKey) {
        toggleSearch();
      }
    });

    document.querySelector('.search-button').addEventListener('click', showSearch);
  });
</script>
